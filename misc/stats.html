<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Mount Stats</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        th {
            cursor: pointer;
        }

        th.sort-asc::after {
            content: " \25B2";
        }

        th.sort-desc::after {
            content: " \25BC";
        }

        select {
            margin: 10px 0;
        }
    </style>
    <script src="mounts_json.js"></script>
    <script src="mount_data.js"></script>
</head>

<body>
    <h2>Mount stats</h2>

    <label for="mountEstimate">Estimated Mounts Collected:</label>
    <select id="mountEstimate">
        <option value="all">Show All</option>
        <option value="10">Up to 10</option>
        <option value="50">Up to 50</option>
        <option value="100">Up to 100</option>
        <option value="150">Up to 150</option>
        <option value="200">Up to 200</option>
        <option value="300">Up to 300</option>
        <option value="400">Up to 400</option>
        <option value="1000">Up to 1000</option>
        <option value="1500">Up to 1500</option>
    </select>

    <table id="statsTable">
        <thead>
            <tr>
                <th data-column="specId">Spec ID</th>
                <th data-column="specName">Spec Name</th>
                <th data-column="raceName">Race Name</th>
                <th data-column="mountCount">Mount Count</th>
            </tr>
        </thead>
        <tbody id="statsBody">
            <!-- Filled by JavaScript -->
        </tbody>
    </table>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const specNames = {
                250: "Blood DK", 251: "Frost DK", 252: "Unholy DK",
                577: "Havoc DH", 581: "Vengeance DH",
                102: "Balance Druid", 9999: "Balance (Glyph)", 103: "Feral Druid", 104: "Guardian Druid", 105: "Restoration Druid",
                1467: "Devastation Evoker", 1468: "Preservation Evoker", 1473: "Augmentation Evoker",
                253: "Beast Mastery Hunter", 254: "Marksmanship Hunter", 255: "Survival Hunter",
                62: "Arcane Mage", 63: "Fire Mage", 64: "Frost Mage",
                268: "Brewmaster Monk", 270: "Mistweaver Monk", 269: "Windwalker Monk",
                65: "Holy Paladin", 66: "Protection Paladin", 70: "Retribution Paladin",
                256: "Discipline Priest", 257: "Holy Priest", 258: "Shadow Priest",
                259: "Assassination Rogue", 260: "Outlaw Rogue", 261: "Subtlety Rogue",
                262: "Elemental Shaman", 263: "Enhancement Shaman", 264: "Restoration Shaman",
                265: "Affliction Warlock", 266: "Demonology Warlock", 267: "Destruction Warlock",
                71: "Arms Warrior", 72: "Fury Warrior", 73: "Protection Warrior"
            };

            const specClasses = {
                250: "Death Knight", 251: "Death Knight", 252: "Death Knight",
                577: "Demon Hunter", 581: "Demon Hunter",
                102: "Druid", 9999: "Druid", 103: "Druid", 104: "Druid", 105: "Druid",
                1467: "Evoker", 1468: "Evoker", 1473: "Evoker",
                253: "Hunter", 254: "Hunter", 255: "Hunter",
                62: "Mage", 63: "Mage", 64: "Mage",
                268: "Monk", 270: "Monk", 269: "Monk",
                65: "Paladin", 66: "Paladin", 70: "Paladin",
                256: "Priest", 257: "Priest", 258: "Priest",
                259: "Rogue", 260: "Rogue", 261: "Rogue",
                262: "Shaman", 263: "Shaman", 264: "Shaman",
                265: "Warlock", 266: "Warlock", 267: "Warlock",
                71: "Warrior", 72: "Warrior", 73: "Warrior"
            };

            const raceNames = {
                Human: "Human", Dwarf: "Dwarf", NightElf: "Night Elf", Gnome: "Gnome", Draenei: "Draenei",
                Worgen: "Worgen", Pandaren: "Pandaren", VoidElf: "Void Elf", LightforgedDraenei: "Lightforged Draenei",
                DarkIronDwarf: "Dark Iron Dwarf", KulTiran: "Kul Tiran", Mechagnome: "Mechagnome",
                Orc: "Orc", Scourge: "Undead", Tauren: "Tauren", Troll: "Troll", BloodElf: "Blood Elf",
                Goblin: "Goblin", Nightborne: "Nightborne", HighmountainTauren: "Highmountain Tauren",
                MagharOrc: "Mag'har Orc", ZandalariTroll: "Zandalari Troll", Vulpera: "Vulpera",
                EarthenDwarf: "Earthen Dwarf", Dracthyr: "Dracthyr"
            };

            const legalCombos = {
                Human: ["Death Knight", "Hunter", "Mage", "Monk", "Paladin", "Priest", "Rogue", "Warlock", "Warrior"],
                Dwarf: ["Death Knight", "Hunter", "Mage", "Paladin", "Priest", "Rogue", "Shaman", "Warlock", "Warrior"],
                NightElf: ["Death Knight", "Druid", "Hunter", "Mage", "Priest", "Rogue", "Warrior"],
                Gnome: ["Death Knight", "Mage", "Monk", "Priest", "Rogue", "Warlock", "Warrior"],
                Draenei: ["Death Knight", "Hunter", "Mage", "Paladin", "Priest", "Shaman", "Warrior"],
                Worgen: ["Death Knight", "Druid", "Hunter", "Mage", "Priest", "Rogue", "Warrior"],
                Pandaren: ["Hunter", "Mage", "Monk", "Priest", "Rogue", "Shaman", "Warrior"],
                VoidElf: ["Death Knight", "Hunter", "Mage", "Monk", "Priest", "Rogue", "Warlock", "Warrior"],
                LightforgedDraenei: ["Death Knight", "Hunter", "Mage", "Paladin", "Priest", "Warrior"],
                DarkIronDwarf: ["Death Knight", "Hunter", "Mage", "Paladin", "Priest", "Rogue", "Shaman", "Warlock", "Warrior"],
                KulTiran: ["Death Knight", "Druid", "Hunter", "Mage", "Priest", "Rogue", "Shaman", "Warrior"],
                Mechagnome: ["Death Knight", "Hunter", "Mage", "Monk", "Priest", "Rogue", "Warlock", "Warrior"],
                Orc: ["Death Knight", "Hunter", "Mage", "Monk", "Priest", "Rogue", "Shaman", "Warlock", "Warrior"],
                Scourge: ["Death Knight", "Hunter", "Mage", "Monk", "Priest", "Rogue", "Warlock", "Warrior"],
                Tauren: ["Death Knight", "Druid", "Hunter", "Monk", "Paladin", "Priest", "Shaman", "Warrior"],
                Troll: ["Death Knight", "Druid", "Hunter", "Mage", "Monk", "Priest", "Rogue", "Shaman", "Warlock", "Warrior"],
                BloodElf: ["Death Knight", "Demon Hunter", "Hunter", "Mage", "Monk", "Paladin", "Priest", "Rogue", "Warlock", "Warrior"],
                Goblin: ["Death Knight", "Hunter", "Mage", "Priest", "Rogue", "Shaman", "Warlock", "Warrior"],
                Nightborne: ["Death Knight", "Hunter", "Mage", "Monk", "Priest", "Rogue", "Warlock", "Warrior"],
                HighmountainTauren: ["Death Knight", "Druid", "Hunter", "Mage", "Monk", "Priest", "Shaman", "Warrior"],
                MagharOrc: ["Death Knight", "Hunter", "Mage", "Monk", "Priest", "Rogue", "Shaman", "Warrior"],
                ZandalariTroll: ["Death Knight", "Druid", "Hunter", "Mage", "Monk", "Paladin", "Priest", "Rogue", "Shaman", "Warrior"],
                Vulpera: ["Death Knight", "Hunter", "Mage", "Priest", "Rogue", "Shaman", "Warlock", "Warrior"],
                EarthenDwarf: ["Death Knight", "Hunter", "Mage", "Paladin", "Priest", "Rogue", "Shaman", "Warlock", "Warrior"],
                Dracthyr: ["Evoker", "Hunter", "Mage", "Priest", "Rogue", "Warlock", "Warrior"]
            };

            const races = Object.keys(raceMountPreferences);
            const specs = Object.keys(specMountTypes).map(Number);
            let fullData = [];
            let currentSort = { column: null, direction: "asc" };

            function mountMatchesFilters(mount, specId, race) {
                const types = specMountTypes[specId];
                const racePrefs = raceMountPreferences[race];
                if (!types || !racePrefs) return false;
                return types.includes(mount.skeleton_type) || racePrefs.includes(mount.skeleton_type);
            }

            function generateStatsData() {
                const rows = [];
                for (const specId of specs) {
                    const className = specClasses[specId];
                    for (const race of races) {
                        if (!legalCombos[race] || !legalCombos[race].includes(className)) continue;
                        const matchedMounts = mounts.filter(m => mountMatchesFilters(m, specId, race));
                        rows.push({
                            specId,
                            specName: specNames[specId] || "Unknown",
                            raceName: raceNames[race] || race,
                            matchedMounts,
                            rawCount: matchedMounts.length,
                            mountCount: matchedMounts.length
                        });
                    }
                }
                return rows;
            }

            function applyFiltersAndRender() {
                const estimate = document.getElementById("mountEstimate").value;
                let data = [...fullData];

                if (estimate !== "all") {
                    const est = parseInt(estimate);
                    const uniqueMounts = new Set();
                    mounts.forEach(m => uniqueMounts.add(m.id));
                    const totalGameMounts = uniqueMounts.size;
                    const ratio = est / totalGameMounts;

                    data.forEach(row => {
                        row.mountCount = Math.round(row.rawCount * ratio);
                    });
                } else {
                    data.forEach(row => row.mountCount = row.rawCount);
                }

                if (currentSort.column) {
                    const col = currentSort.column;
                    const dir = currentSort.direction;
                    data.sort((a, b) => {
                        if (a[col] < b[col]) return dir === "asc" ? -1 : 1;
                        if (a[col] > b[col]) return dir === "asc" ? 1 : -1;
                        return 0;
                    });
                }

                renderTable(data);
            }

            function renderTable(data) {
                const tbody = document.getElementById("statsBody");
                tbody.innerHTML = "";
                const fragment = document.createDocumentFragment();
                for (const row of data) {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `<td>${row.specId}</td><td>${row.specName}</td><td>${row.raceName}</td><td>${row.mountCount}</td>`;
                    fragment.appendChild(tr);
                }
                tbody.appendChild(fragment);
            }

            document.querySelectorAll("th").forEach(th => {
                th.addEventListener("click", () => {
                    const col = th.getAttribute("data-column");
                    const dir = (currentSort.column === col && currentSort.direction === "asc") ? "desc" : "asc";
                    currentSort = { column: col, direction: dir };

                    document.querySelectorAll("th").forEach(th => th.classList.remove("sort-asc", "sort-desc"));
                    th.classList.add(dir === "asc" ? "sort-asc" : "sort-desc");

                    applyFiltersAndRender();
                });
            });

            document.getElementById("mountEstimate").addEventListener("change", applyFiltersAndRender);

            fullData = generateStatsData();
            applyFiltersAndRender();
        });
    </script>
</body>

</html>